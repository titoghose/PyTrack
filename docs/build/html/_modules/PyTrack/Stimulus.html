
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>PyTrack.Stimulus &#8212; PyTrack 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">PyTrack 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for PyTrack.Stimulus</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">signal</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">misc</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="k">import</span> <span class="n">Slider</span><span class="p">,</span> <span class="n">CheckButtons</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">from</span> <span class="nn">Sensor</span> <span class="k">import</span> <span class="n">Sensor</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage.filters</span> <span class="k">import</span> <span class="n">gaussian_filter</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;TkAgg&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Stimulus"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus">[docs]</a><span class="k">class</span> <span class="nc">Stimulus</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;This is the main class that performs analysis and visualization of data collected during presentation of various stimuli during the experiment. </span>

<span class="sd">	If the framework is used in the *Experiment Design* objects of this class are created implicitly and the user need not worry about the internal functioning of the class methods. However, if using the *Stand-alone Design*, the user needs to explicitly create an object of the class and invoke the functions based on what is needed. </span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	path : str</span>
<span class="sd">		This parameter is the absolute path to the experiment directory containing the json file, stimuli folder with pictures etc. For the *Experiment Design*, this parameter is internally handled. In the *Stand-alone Design*, this parameter needs to be specified while creating the object.</span>
<span class="sd">	name : str </span>
<span class="sd">		The name of the stimulus. For the *Experiment Design*, this parameter is internally handled. If using in *Stand-alone Design*, this parameter is optional and will default to `id_rather_not`.</span>
<span class="sd">	stim_type : str	</span>
<span class="sd">		The type of stimulus, if there are different classes of stimulus in the experiment. For the *Experiment Design*, this parameter is internally handled. If using in *Stand-alone Design*, this parameter is optional and will default to `doesnt_matter`.</span>
<span class="sd">	sensor_names : list(str) | dict</span>
<span class="sd">		In the *Experiment Design* `sensor_names` will default to the sensors being used (as mentioned in the json_file). As of now this only supports EyeTracker. If using in *Stand-alone Design*, this parameter must be a dictionary of dictionaries with the details of the sensors and their attributes. The framework as of now just supports Eye Tracking so in the *Stand-alone Design*, `sensor_names` should be in this format (edit the value of the &quot;Sampling_Freq&quot; according to your eye tracker&#39;s value): </span>
<span class="sd">		{&quot;EyeTracker&quot;: {&quot;Sampling_Freq&quot;:1000}}</span>
<span class="sd">	data : pandas DataFrame</span>
<span class="sd">		The data for this stimulus as a Pandas DataFrame. For the *Experiment Design*, this parameter is internally handled. In the *Stand-alone Design* use the `formatBridge.generateCompatibleFormat` module to convert your data into the accepted format and then pass the csv file as a Pandas DataFrame to `data`. This should be the data for just a single stimulus or else the features extracted will not make sense to you. In case you wish to analyse all stimuli for 1 subject, we suggest using the *Experiment Design*.</span>
<span class="sd">	start_time : int</span>
<span class="sd">		The onset of stimulus. For the *Experiment Design*, this parameter is internally handled and if -1, it implies that data for stimulus is missing. In the *Stand-alone Design*, this parameter is optional (0 by default) and need not be mentioned. However, if supplying an entire dataframe and it is desired to analyse data in a given range, supply the index value to start from. Also specify `end_time` or else -1 is used by default i.e end of DataFrame. </span>
<span class="sd">	end_time : int</span>
<span class="sd">		The offset of stimulus. For the *Experiment Design*, this parameter is internally handled and if -1, it implies that data for stimulus is missing. In the *Stand-alone Design*, this parameter is optional (-1 by default) and need not be mentioned. However, if supplying an entire dataframe and it is desired to analyse data in a given range, supply the index value to end at. Also specify `start_time` or else 0 is used by default i.e start of DataFrame.</span>
<span class="sd">	roi_time : int</span>

<span class="sd">	json_file : str </span>
<span class="sd">		Desciption of experiment as JSON file. For the *Experiment Design*, this parameter is internally handled. In the *Stand-alone Design* it is not required (leave as ``None``).</span>
<span class="sd">	subject_name : str (optional)</span>
<span class="sd">		Name of the subject being analysed. For the *Experiment Design*, this parameter is internally handled. In the *Stand-alone Design* it is optional (Defaults to buttersnaps).</span>

<span class="sd">	&quot;&quot;&quot;</span>


	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;id_rather_not&quot;</span><span class="p">,</span> <span class="n">stim_type</span><span class="o">=</span><span class="s2">&quot;doesnt_matter&quot;</span><span class="p">,</span> <span class="n">sensor_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">roi_time</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subject_name</span><span class="o">=</span><span class="s2">&quot;buttersnaps&quot;</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stim_type</span> <span class="o">=</span> <span class="n">stim_type</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">end_time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">response_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">roi_time</span> <span class="o">=</span> <span class="n">roi_time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">json_file</span> <span class="o">=</span> <span class="n">json_file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">=</span> <span class="n">subject_name</span>
		
		
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/Subjects/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/Subjects/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>

		<span class="c1"># Experiment json file exists so stimulus is being created for experiment</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sensor_names</span><span class="p">)</span>
		
		<span class="c1"># Experiment json file does not exist so stimulus is being created as a stand alone object</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataStandAlone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sensor_names</span><span class="p">)</span>


<div class="viewcode-block" id="Stimulus.diff"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.diff">[docs]</a>	<span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Python implementation of Matlab&#39;s &#39;diff&#39; function. </span>
<span class="sd">		</span>
<span class="sd">		Computes the difference between (n+1)th and (n)th elements of array. Returns (a[n+1] - a[n]) for all n.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		series : list | array (numeric)</span>
<span class="sd">			Numeric list, of type ``int`` or ``float``. Must be atleast of length 2.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		list | array (numeric)</span>
<span class="sd">			The size of the returned list is n-1 where n is the size of `series` supplied to the `diff`.</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">series</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">series</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="Stimulus.smooth"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.smooth">[docs]</a>	<span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">window_len</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Smoothing function to compute running average.</span>
<span class="sd">		</span>
<span class="sd">		Computes the running average for a window size of `window_len`. For the boundary values (`window_len`-1 values at start and end) the window length is reduced to accommodate no padding.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		x : list | array (numeric)</span>
<span class="sd">			Numeric list, of type ``int`` or ``float`` to compute running average for.</span>
<span class="sd">		window_len : int</span>
<span class="sd">			Size of averaging window. Must be odd and &gt;= 3.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		y : list | array (numeric)</span>
<span class="sd">			Smoothed version `x`. </span>
<span class="sd">			</span>
<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="c1"># Running average smoothing</span>
		<span class="k">if</span> <span class="n">window_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">x</span>

		<span class="c1"># Window length must be odd</span>
		<span class="k">if</span> <span class="n">window_len</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">window_len</span> <span class="o">+=</span> <span class="mi">1</span>
		
		<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window_len</span><span class="p">)</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="p">[:</span><span class="n">window_len</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">window_len</span><span class="o">//</span><span class="mi">2</span><span class="p">:]))</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">window_len</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
			<span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">window_len</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
			<span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">/</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="Stimulus.findBlinks"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findBlinks">[docs]</a>	<span class="k">def</span> <span class="nf">findBlinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pupil_size</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">concat_gap_interval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Finds indices of occurances of blinks and interpolates pupil size and gaze data. </span>
<span class="sd">		</span>
<span class="sd">		Function to find blinks and return blink onset, offset indices and interpolated pupil size data. </span>
<span class="sd">		Adapted from: R. Hershman, A. Henik, and N. Cohen, â€œA novel blink detection method based on pupillometry noise,&quot; Behav. Res. Methods, vol. 50, no. 1, pp. 107-114, 2018. </span>
<span class="sd">		Goto https://osf.io/jyz43/ for R and Matlab implementation. </span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		pupil_size : array | list</span>
<span class="sd">			Pupil size data for left or right eye</span>
<span class="sd">		gaze : dict of list</span>
<span class="sd">			Gaze in x and y direction. {&quot;x&quot; : list , &quot;y&quot; : list } </span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling frequency of eye tracking hardware (Defaults to 1000).</span>
<span class="sd">		concat : bool </span>
<span class="sd">			Concatenate close blinks/missing trials or not. ``False`` by default. See R. Hershman et. al. for more information </span>
<span class="sd">		concat_gap_interval : float </span>
<span class="sd">			Minimum interval between successive missing samples/blinks to consider for concatenation. If `concat` is ``False`` this parameter does not matter. Default value is 100.</span>
<span class="sd">		interpolate : bool</span>
<span class="sd">			Interpolate pupil and gaze data durig blinks (Defaults to `False``).</span>

<span class="sd">		Returns</span>
<span class="sd">		-------	</span>
<span class="sd">		blinks : dict</span>
<span class="sd">			Blink onset and offset indices. {&quot;blink_onset&quot; : list , &quot;blink_offset&quot; : list} </span>
<span class="sd">		interp_pupil_size : array | list </span>
<span class="sd">			Interpolated pupil size data for left or right eye after fixing blinks. If `interpolate`=``False``, this is the same as `pupil_size` supplied to the function.</span>
<span class="sd">		new_gaze : dict</span>
<span class="sd">			Interpolated gaze in x and y direction after fixing blinks. If `interpolate`=``False``, this is the same as `gaze` supplied to the function. {&quot;x&quot; : list, &quot;y&quot; : list} </span>

<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="n">blink_onset</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">blink_offset</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">blinks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">:</span> <span class="n">blink_onset</span><span class="p">,</span> <span class="s2">&quot;blink_offset&quot;</span><span class="p">:</span> <span class="n">blink_offset</span><span class="p">}</span>
		
		<span class="n">sampling_interval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">//</span> <span class="n">sampling_freq</span>
		
		<span class="n">missing_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pupil_size</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
		<span class="n">difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">missing_data</span><span class="p">)</span>
		
		<span class="n">blink_onset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">difference</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">blink_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">difference</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
		
		<span class="n">blink_onset</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">)</span>
		<span class="n">blink_offset</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">blink_offset</span><span class="p">)</span>

		<span class="n">length_blinks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blink_offset</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="p">(</span><span class="n">length_blinks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">blinks</span><span class="p">,</span> <span class="n">pupil_size</span><span class="p">,</span> <span class="n">gaze</span>

		<span class="c1"># Edge Case 2: the data starts with a blink. In this case, blink onset will be defined as the first missing value.</span>
		<span class="k">if</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">blink_onset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">blink_offset</span><span class="p">)))</span> <span class="ow">and</span> <span class="n">pupil_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> 
			<span class="n">blink_onset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">blink_onset</span><span class="p">))</span>
		
		<span class="c1"># Edge Case 3: the data ends with a blink. In this case, blink offset will be defined as the last missing sample</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blink_offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">))</span> <span class="ow">and</span> <span class="n">pupil_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">blink_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">blink_offset</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

		<span class="n">ms_4_smoothing</span> <span class="o">=</span> <span class="mi">10</span>
		<span class="n">samples2smooth</span> <span class="o">=</span> <span class="n">ms_4_smoothing</span> <span class="o">//</span> <span class="n">sampling_interval</span>
		<span class="n">smooth_pupil_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">,</span> <span class="n">samples2smooth</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
		
		<span class="n">smooth_pupil_size</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">smooth_pupil_size</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
		<span class="n">smooth_pupil_size_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">smooth_pupil_size</span><span class="p">)</span>
		
		<span class="n">monotonically_dec</span> <span class="o">=</span> <span class="n">smooth_pupil_size_diff</span> <span class="o">&lt;=</span> <span class="mi">0</span>
		<span class="n">monotonically_inc</span> <span class="o">=</span> <span class="n">smooth_pupil_size_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span>
		
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">)):</span>
			<span class="c1"># Edge Case 2: If data starts with blink we do not update it and let starting blink index be 0</span>
			<span class="k">if</span> <span class="n">blink_onset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">j</span> <span class="o">=</span> <span class="n">blink_onset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
				<span class="k">while</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">monotonically_dec</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
					<span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span>
				<span class="n">blink_onset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
				
			<span class="c1"># Edge Case 3: If data ends with blink we do not update it and let ending blink index be the last index of the data</span>
			<span class="k">if</span> <span class="n">blink_offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">j</span> <span class="o">=</span> <span class="n">blink_offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">monotonically_inc</span><span class="p">)</span> <span class="ow">and</span> <span class="n">monotonically_inc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
					<span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="n">blink_offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>

		<span class="k">if</span> <span class="n">concat</span><span class="p">:</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">blink_offset</span><span class="p">),))</span>
			<span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">blink_onset</span>
			<span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">blink_offset</span>
			<span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

			<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">concat_gap_interval</span><span class="p">:</span>
					<span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>

			<span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
			<span class="n">blink_onset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
			<span class="n">blink_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
		
		<span class="n">blinks</span><span class="p">[</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blink_onset</span>
		<span class="n">blinks</span><span class="p">[</span><span class="s2">&quot;blink_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blink_offset</span>

		<span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>

			<span class="n">pupil_size_no_blinks</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">pupil_size_no_blinks_indices</span> <span class="o">=</span> <span class="p">[]</span>
			
			<span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
			
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blink_onset</span><span class="p">)):</span>
				<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">pupil_size_no_blinks_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">blink_onset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">pupil_size_no_blinks</span> <span class="o">=</span> <span class="n">pupil_size</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">blink_onset</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">prev</span> <span class="o">=</span> <span class="n">blink_offset</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
					<span class="n">pupil_size_no_blinks_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pupil_size_no_blinks_indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">blink_onset</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
					<span class="n">pupil_size_no_blinks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pupil_size_no_blinks</span><span class="p">,</span> <span class="n">pupil_size</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">blink_onset</span><span class="p">[</span><span class="n">i</span><span class="p">])]))</span>
			
			<span class="n">pupil_size_no_blinks_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
				<span class="p">(</span><span class="n">pupil_size_no_blinks_indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">blink_offset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">))))</span>
			<span class="n">pupil_size_no_blinks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pupil_size_no_blinks</span><span class="p">,</span> <span class="n">pupil_size</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">blink_offset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">))]))</span>
			
			
			<span class="n">interp_pupil_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pupil_size_no_blinks_indices</span><span class="p">),</span>
										  <span class="n">pupil_size_no_blinks</span><span class="p">)</span>
			
			<span class="k">if</span> <span class="n">gaze</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">new_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
				<span class="k">for</span> <span class="n">eye</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]:</span>
					<span class="n">gaze_x</span> <span class="o">=</span> <span class="n">gaze</span><span class="p">[</span><span class="n">eye</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
					<span class="n">gaze_y</span> <span class="o">=</span> <span class="n">gaze</span><span class="p">[</span><span class="n">eye</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
					
					<span class="n">gaze_x_no_blinks</span> <span class="o">=</span> <span class="n">gaze_x</span><span class="p">[</span><span class="n">pupil_size_no_blinks_indices</span><span class="p">]</span>
					<span class="n">gaze_y_no_blinks</span> <span class="o">=</span> <span class="n">gaze_y</span><span class="p">[</span><span class="n">pupil_size_no_blinks_indices</span><span class="p">]</span>

					<span class="c1"># if eye == &quot;left&quot;:</span>
					<span class="c1"># 	plt.plot(gaze_x, gaze_y)</span>

					<span class="n">interp_gaze_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pupil_size_no_blinks_indices</span><span class="p">),</span> <span class="n">gaze_x_no_blinks</span><span class="p">)</span>
					<span class="n">interp_gaze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pupil_size_no_blinks_indices</span><span class="p">),</span> <span class="n">gaze_y_no_blinks</span><span class="p">)</span>

					<span class="c1"># if eye == &quot;left&quot;:</span>
					<span class="c1"># 	plt.plot(interp_gaze_x, interp_gaze_y, alpha=0.5)</span>

					<span class="c1"># plt.show()</span>
					<span class="n">new_gaze</span><span class="p">[</span><span class="n">eye</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">interp_gaze_x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">interp_gaze_y</span><span class="p">}</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="n">interp_pupil_size</span> <span class="o">=</span> <span class="n">pupil_size</span>
			<span class="n">new_gaze</span> <span class="o">=</span> <span class="n">gaze</span>

		<span class="k">return</span> <span class="n">blinks</span><span class="p">,</span> <span class="n">interp_pupil_size</span><span class="p">,</span> <span class="n">new_gaze</span></div>


<div class="viewcode-block" id="Stimulus.findFixations"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findFixations">[docs]</a>	<span class="k">def</span> <span class="nf">findFixations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to extract indices of fixation sequences.</span>
<span class="sd">		</span>
<span class="sd">		Internal function of class that uses its `data` member variable to compute indices. Does not take any input and can be invoked by an object of the class. Serves as a helper function.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		fixation_indices : dict</span>
<span class="sd">			Indices of start and end of fixations. {&quot;start&quot;: fixation_onset list, &quot;end&quot;: fixation_offset list}</span>

<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">fixation_onset</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">fixation_offset</span> <span class="o">=</span> <span class="p">[]</span>
	
		<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
	
		<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">]):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
				<span class="n">curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
				<span class="n">fixation_onset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
				<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">curr</span><span class="p">:</span>
					<span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="n">fixation_offset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
	
		<span class="n">fixation_indices</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">fixation_onset</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">fixation_offset</span><span class="p">}</span>

		<span class="k">return</span> <span class="n">fixation_indices</span></div>


<div class="viewcode-block" id="Stimulus.findSaccades"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findSaccades">[docs]</a>	<span class="k">def</span> <span class="nf">findSaccades</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to extract indices of saccade sequences.</span>
<span class="sd">		</span>
<span class="sd">		Saccades are assumed to be interspersed between fixations. Internal function of class that uses its `data` member variable to compute indices. Does not take any input and can be invoked by an object of the class. Serves as a helper function.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		saccade_indices : dict</span>
<span class="sd">			Indices of start and end of saccades. {&quot;start&quot;: saccade_onset list, &quot;end&quot;: saccade_offset list}</span>

<span class="sd">		&quot;&quot;&quot;</span>
	
		<span class="n">saccade_onset</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">saccade_offset</span> <span class="o">=</span> <span class="p">[]</span>
	
		<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">]):</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
				<span class="n">saccade_onset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
				<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
					<span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="n">saccade_offset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
	
		<span class="n">saccade_indices</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">saccade_onset</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">saccade_offset</span><span class="p">}</span>

		<span class="k">return</span> <span class="n">saccade_indices</span></div>


<div class="viewcode-block" id="Stimulus.position2Velocity"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.position2Velocity">[docs]</a>	<span class="k">def</span> <span class="nf">position2Velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gaze</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to calculate velocity for a gaze point based on a 6 sample window.</span>
<span class="sd">		</span>
<span class="sd">		Serves as a helper function. See `findMicrosaccades`</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		gaze : array | list </span>
<span class="sd">			Gaze positons in x or y direction.</span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling Frequency of eye tracker.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		velocity : array | list </span>
<span class="sd">			Gaze velocities in x or y direction.</span>

<span class="sd">		&quot;&quot;&quot;</span>
	
		<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gaze</span><span class="p">)</span>
		<span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">gaze</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
	
		<span class="n">velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gaze</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">gaze</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gaze</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">sampling_freq</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>
		<span class="n">velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gaze</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">sampling_freq</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
		<span class="n">velocity</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gaze</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gaze</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">sampling_freq</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
	
		<span class="k">return</span> <span class="n">velocity</span></div>


<div class="viewcode-block" id="Stimulus.smoothGaze"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.smoothGaze">[docs]</a>	<span class="k">def</span> <span class="nf">smoothGaze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">gaze</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to smoothen gaze positions using running average method.</span>
<span class="sd">		</span>
<span class="sd">		Serves as a helper function. See `findMicrosaccades`</span>
<span class="sd"> </span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		vel : array | list </span>
<span class="sd">			Gaze velocities in x or y direction</span>
<span class="sd">		gaze : array | list </span>
<span class="sd">			Gaze positons in x or y direction</span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling Frequency of eye tracker</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		smooth_gaze : array | list </span>
<span class="sd">			Smoothened gaze positons in x or y direction</span>

<span class="sd">		&quot;&quot;&quot;</span>
	
		<span class="n">smooth_gaze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">gaze</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
	
		<span class="n">smooth_gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">smooth_gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">smooth_gaze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>
	
		<span class="k">return</span> <span class="n">smooth_gaze</span></div>


<div class="viewcode-block" id="Stimulus.calculateMSThreshold"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.calculateMSThreshold">[docs]</a>	<span class="k">def</span> <span class="nf">calculateMSThreshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">,</span> <span class="n">VFAC</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to calculate velocity threshold value for X and Y directions to classify point as a microsaccade point.</span>
<span class="sd">	</span>
<span class="sd">		Serves as a helper function. See `findMicrosaccades`</span>

<span class="sd">		Parameters</span>
<span class="sd">		---------</span>
<span class="sd">		vel : array | list</span>
<span class="sd">			Gaze velocity in x or y direction</span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling frequency of the eye tracking device</span>
<span class="sd">		VFAC : float</span>
<span class="sd">			Scalar constant used to find threshold (Defaults to 5.0). See R. Engbert and K. Mergenthaler, â€œMicrosaccades are triggered by low retinal image slip,â€ Proc. Natl. Acad. Sci., vol. 103, no. 18, pp. 7192â€“7197, 2006.</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		radius : float</span>
<span class="sd">			Threshold radius in x or y direction</span>

<span class="sd">		&quot;&quot;&quot;</span>
	
		<span class="n">medx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>
		<span class="n">msdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">((</span><span class="n">vel</span><span class="o">-</span><span class="n">medx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
	
		<span class="k">if</span> <span class="n">msdx</span><span class="o">&lt;</span><span class="mf">1e-10</span><span class="p">:</span>
			<span class="n">msdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vel</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vel</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
	
		<span class="n">radius</span> <span class="o">=</span> <span class="n">VFAC</span> <span class="o">*</span> <span class="n">msdx</span>
		<span class="k">return</span> <span class="n">radius</span></div>


<div class="viewcode-block" id="Stimulus.findBinocularMS"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findBinocularMS">[docs]</a>	<span class="k">def</span> <span class="nf">findBinocularMS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msl</span><span class="p">,</span> <span class="n">msr</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find binocular microsaccades from monocular microsaccades.</span>

<span class="sd">		Serves as helper function. See `findMicrosaccades`</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		msl : array | list (num_ms, 9)</span>
<span class="sd">			Microsaccade list returned by `findMonocularMS` for the left eye. `num_ms` stands for the number of left eye microsaccades.</span>
<span class="sd">		msr : array | list (num_ms, 9)</span>
<span class="sd">			Microsaccade list returned by `findMonocularMS` for the right eye. `num_ms` stands for the number of right eye microsaccades.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		ms : dict</span>
<span class="sd">			Dictionary of values containing the number of binary microsaccades, number of left eye microsaccades, number of right eye microsaccades, binary microsaccades list, left microsaccades list and right microsaccades list.</span>
<span class="sd">			- &quot;NB&quot; : int </span>
<span class="sd">			- &quot;NR&quot; : int </span>
<span class="sd">			- &quot;NL&quot; : int</span>
<span class="sd">			- &quot;bin&quot; : array | list (num_ms, 18) </span>
<span class="sd">			- &quot;left&quot; : array | list (num_ms, 9) </span>
<span class="sd">			- &quot;right&quot; : array | list (num_ms, 9)</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">numr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msl</span><span class="p">)</span>
		<span class="n">numl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msr</span><span class="p">)</span>

		<span class="n">bin_ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
		<span class="n">monol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
		<span class="n">monor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

		<span class="n">NB</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">NR</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">NL</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">numr</span> <span class="o">*</span> <span class="n">numl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">TL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">msl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
			<span class="n">TR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">msr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
			<span class="n">TB</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">TL</span><span class="p">,</span> <span class="n">TR</span><span class="p">)))</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">TB</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
			
			<span class="k">for</span> <span class="n">left_coords</span> <span class="ow">in</span> <span class="n">msl</span><span class="p">:</span>
				<span class="n">s</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">left_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">left_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

			<span class="k">for</span> <span class="n">right_coords</span> <span class="ow">in</span> <span class="n">msr</span><span class="p">:</span>
				<span class="n">s</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">right_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">right_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

			<span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">s</span><span class="p">[</span><span class="n">TB</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

			<span class="n">onoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">onoff</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
			<span class="n">N</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="c1"># print(m)</span>

			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
				<span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">msl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">msl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">msr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">msr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

				<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">ampr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
					<span class="n">ampl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

					<span class="n">ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ampr</span><span class="p">)</span>
					<span class="n">il</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ampl</span><span class="p">)</span>
					<span class="n">NB</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="k">if</span> <span class="n">NB</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">bin_ms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">il</span><span class="p">],</span> <span class="p">:]</span>
						<span class="n">bin_ms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span> <span class="p">:]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">bin_ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">bin_ms</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">il</span><span class="p">],</span> <span class="p">:],</span> <span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span> <span class="p">:]))))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">NL</span> <span class="o">+=</span> <span class="mi">1</span>
						<span class="n">ampl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
						<span class="n">il</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ampl</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">NL</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">monol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">il</span><span class="p">],</span> <span class="p">:]</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">monol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">monol</span><span class="p">,</span> <span class="n">msl</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">il</span><span class="p">],</span> <span class="p">:]))</span>

					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">NR</span> <span class="o">+=</span> <span class="mi">1</span>
						<span class="n">ampr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
						<span class="n">ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ampr</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">NR</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">monor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span> <span class="p">:]</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">monor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">monor</span><span class="p">,</span> <span class="n">msr</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span> <span class="p">:]))</span>

		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">numr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">bin_ms</span> <span class="o">=</span> <span class="kc">None</span>
				<span class="n">monor</span> <span class="o">=</span> <span class="kc">None</span>
				<span class="n">monol</span> <span class="o">=</span> <span class="n">msl</span>
			<span class="k">if</span> <span class="n">numl</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">bin_ms</span> <span class="o">=</span> <span class="kc">None</span>
				<span class="n">monor</span> <span class="o">=</span> <span class="n">msr</span>
				<span class="n">monol</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="n">ms</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NB&quot;</span> <span class="p">:</span> <span class="n">NB</span><span class="p">,</span> <span class="s2">&quot;NR&quot;</span> <span class="p">:</span> <span class="n">NR</span><span class="p">,</span> <span class="s2">&quot;NL&quot;</span> <span class="p">:</span> <span class="n">NL</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span> <span class="p">:</span> <span class="n">bin_ms</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="n">monol</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="n">monor</span><span class="p">}</span>

		<span class="k">return</span> <span class="n">ms</span>	</div>

	
<div class="viewcode-block" id="Stimulus.findMonocularMS"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findMonocularMS">[docs]</a>	<span class="k">def</span> <span class="nf">findMonocularMS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gaze</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find binocular microsaccades from monocular microsaccades.</span>

<span class="sd">		Serves as helper function. See `findMicrosaccades`</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		gaze : array | list </span>
<span class="sd">			Gaze positons in x or y direction</span>
<span class="sd">		vel : array | list </span>
<span class="sd">			Gaze velocities in x or y direction</span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling Frequency of eye tracker (Defaults to 1000)</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		MS : array (num_ms, 9)</span>
<span class="sd">			Array of 9 microsaccade Parameters. These Parameters correspond to the following array indices</span>
<span class="sd">			0. starting index</span>
<span class="sd">			1. ending index</span>
<span class="sd">			2. peak velocity</span>
<span class="sd">			3. microsaccade gaze vector (x direction)</span>
<span class="sd">			4. microsaccade gaze vector (y direction)</span>
<span class="sd">			5. amplitude (x direction)</span>
<span class="sd">			6. amplitude (y direction)</span>
<span class="sd">			7. threshold radius (x direction)</span>
<span class="sd">			8. threshold radius (y direction)</span>
<span class="sd">			num_ms = `ms_count`</span>
<span class="sd">		ms_count : int</span>
<span class="sd">			Number of microsaccades</span>
<span class="sd">		ms_duration : list(int)</span>
<span class="sd">			List of duration of each microsaccade. Contains as many values as `ms_count`</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">MINDUR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">sampling_freq</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
		<span class="n">gaze_x</span> <span class="o">=</span> <span class="n">gaze</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
		<span class="n">gaze_y</span> <span class="o">=</span> <span class="n">gaze</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

		<span class="n">vel_x</span> <span class="o">=</span> <span class="n">vel</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
		<span class="n">vel_y</span> <span class="o">=</span> <span class="n">vel</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

			<span class="c1"># for i in range(len(fixation_indices[&quot;start&quot;])):</span>
		<span class="c1"># 	print(fixation_indices[&quot;start&quot;][i], fixation_indices[&quot;end&quot;][i])</span>

		<span class="n">radius_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateMSThreshold</span><span class="p">(</span><span class="n">vel_x</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">)</span>
		<span class="n">radius_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateMSThreshold</span><span class="p">(</span><span class="n">vel_y</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="p">)</span>

		<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">vel_x</span><span class="o">/</span><span class="n">radius_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">vel_y</span><span class="o">/</span><span class="n">radius_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		<span class="n">ms_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

		<span class="c1"># for ind, msi in enumerate(ms_indices):</span>
		<span class="c1"># 	print(ind, msi)</span>

		<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms_indices</span><span class="p">)</span> 
		<span class="n">num_ms</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">MS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
		<span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="c1"># Loop over saccade candidates</span>
		<span class="k">while</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ms_indices</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ms_indices</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">duration</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># Minimum duration criterion (exception: last saccade)</span>
				<span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;=</span> <span class="n">MINDUR</span><span class="p">:</span>
					<span class="n">num_ms</span> <span class="o">+=</span> <span class="mi">1</span>
					<span class="n">b</span> <span class="o">=</span> <span class="n">k</span>
					<span class="k">if</span> <span class="n">num_ms</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_indices</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
						<span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_indices</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">new_ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ms_indices</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">ms_indices</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
						<span class="n">MS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">MS</span><span class="p">,</span> <span class="n">new_ms</span><span class="p">))</span>
				
				<span class="n">a</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>
				<span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span>

			<span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

		<span class="c1"># Check minimum duration for last microsaccade</span>
		<span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;=</span> <span class="n">MINDUR</span><span class="p">:</span>
			<span class="n">num_ms</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="n">b</span> <span class="o">=</span> <span class="n">k</span>
			<span class="k">if</span> <span class="n">num_ms</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_indices</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
				<span class="n">MS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_indices</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">new_ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ms_indices</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">ms_indices</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
				<span class="n">MS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">MS</span><span class="p">,</span> <span class="n">new_ms</span><span class="p">))</span>

		<span class="k">if</span> <span class="n">num_ms</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="c1"># Compute peak velocity, horiztonal and vertical components</span>
			<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ms</span><span class="p">):</span>
				
				<span class="c1"># Onset and offset for saccades</span>
				<span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
				<span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

				<span class="c1"># Saccade peak velocity (vpeak)</span>
				<span class="n">vpeak</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vel_x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vel_y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
				<span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vpeak</span>

				<span class="c1"># Saccade vector (dx,dy)</span>
				<span class="n">dx</span> <span class="o">=</span> <span class="n">gaze_x</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">gaze_x</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
				<span class="n">dy</span> <span class="o">=</span> <span class="n">gaze_y</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">gaze_y</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
				<span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx</span>
				<span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">dy</span>

				<span class="c1"># Saccade amplitude (dX,dY)</span>
				<span class="n">minx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">gaze_y</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gaze_y</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">ix1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">ix2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">iy1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">gaze_y</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">iy2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">gaze_y</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
				<span class="n">dX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ix2</span> <span class="o">-</span> <span class="n">ix1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">)</span>
				<span class="n">dY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">iy2</span> <span class="o">-</span> <span class="n">iy1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span>
				<span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">dX</span>
				<span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">dY</span>

				<span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius_x</span>
				<span class="n">MS</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius_y</span>

		<span class="n">ms_count</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">ms_duration</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="n">ms_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MS</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">MS</span><span class="p">:</span>
			<span class="n">ms_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MS</span><span class="p">),</span> <span class="n">ms_count</span><span class="p">,</span> <span class="n">ms_duration</span></div>


<div class="viewcode-block" id="Stimulus.findMicrosaccades"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findMicrosaccades">[docs]</a>	<span class="k">def</span> <span class="nf">findMicrosaccades</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">plot_ms</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to detect microsaccades within fixations.</span>
<span class="sd">		</span>
<span class="sd">		Adapted from R. Engbert and K. Mergenthaler, â€œMicrosaccades are triggered by low retinal image slip,â€ Proc. Natl. Acad. Sci., vol. 103, no. 18, pp. 7192â€“7197, 2006.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling Frequency of eye tracker (Defaults to 1000)</span>
<span class="sd">		plot_ms : bool</span>
<span class="sd">			Wether to plot microsaccade plots and main sequence or not (Defaults to ``False``). If ``True``, the figures will be plot and saved in the folder Subjects in the experiment folder.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		all_bin_MS : return value of `findBinocularMS`</span>
<span class="sd">			All the binocular microsaccades found for the given stimuli.</span>
<span class="sd">		ms_count : int</span>
<span class="sd">			Total count of all binocular and monocular microsaccades.</span>
<span class="sd">		ms_duration : list(sloat)</span>
<span class="sd">			List of durations of all microsaccades.</span>
<span class="sd">		temp_vel : list(float) </span>
<span class="sd">			List of peak velocities of all microsaccades.</span>
<span class="sd">		temp_amp : list(float)</span>
<span class="sd">			List of amplitudes of all microsaccades.</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">fixation_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findFixations</span><span class="p">()</span>
		<span class="n">all_bin_MS</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">fix_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fixation_indices</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">])):</span>

			<span class="n">all_MS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
			<span class="n">ms_count</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
			<span class="n">ms_duration</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
			<span class="n">smooth_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
			<span class="n">vel</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>


			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]:</span>

				<span class="n">curr_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">fixation_indices</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">][</span><span class="n">fix_ind</span><span class="p">]</span> <span class="p">:</span> <span class="n">fixation_indices</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">][</span><span class="n">fix_ind</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
							<span class="s2">&quot;y&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">fixation_indices</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">][</span><span class="n">fix_ind</span><span class="p">]</span> <span class="p">:</span> <span class="n">fixation_indices</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">][</span><span class="n">fix_ind</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]}</span>

				<span class="n">vel_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position2Velocity</span><span class="p">(</span><span class="n">curr_gaze</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="p">)</span>
				<span class="n">vel_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position2Velocity</span><span class="p">(</span><span class="n">curr_gaze</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="p">)</span>
				<span class="n">temp_vel</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span> <span class="p">:</span> <span class="n">vel_x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span> <span class="p">:</span> <span class="n">vel_y</span><span class="p">}</span>
				<span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_vel</span>

				<span class="n">smooth_gaze_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothGaze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position2Velocity</span><span class="p">(</span><span class="n">curr_gaze</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">curr_gaze</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="p">)</span>
				<span class="n">smooth_gaze_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothGaze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position2Velocity</span><span class="p">(</span><span class="n">curr_gaze</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">curr_gaze</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="p">)</span>
				<span class="n">temp_smooth_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span> <span class="p">:</span> <span class="n">smooth_gaze_x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span> <span class="p">:</span> <span class="n">smooth_gaze_y</span><span class="p">}</span>
				<span class="n">smooth_gaze</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_smooth_gaze</span>

				<span class="n">all_MS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ms_count</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ms_duration</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findMonocularMS</span><span class="p">(</span><span class="n">curr_gaze</span><span class="p">,</span> <span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="p">)</span>

			<span class="n">MS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findBinocularMS</span><span class="p">(</span><span class="n">all_MS</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span> <span class="n">all_MS</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">])</span>
			<span class="n">all_bin_MS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MS</span><span class="p">)</span>
			

			<span class="k">if</span> <span class="n">plot_ms</span><span class="p">:</span>
				
				<span class="c1"># Plot gaze and velocity with thresholds</span>
				<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
				<span class="n">a1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">a2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

				<span class="n">a1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_gaze</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">smooth_gaze</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
				<span class="n">a1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
				<span class="n">a1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
				<span class="n">a1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;gaze plot&quot;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">])):</span>
					<span class="n">a1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_gaze</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">smooth_gaze</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

				<span class="n">e</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
				<span class="n">a2</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

				<span class="n">a2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">vel</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">a2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;vel-x&quot;</span><span class="p">)</span>
				<span class="n">a2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;vel-y&quot;</span><span class="p">)</span>
				<span class="n">a2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;gaze velocity plot&quot;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">])):</span>
					<span class="n">a2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">vel</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">MS</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> 

				<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Subjects/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">+</span> <span class="s2">&quot;/ms_gaze_vel/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fix_ind</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
				<span class="n">fig</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


			<span class="k">if</span> <span class="n">plot_ms</span><span class="p">:</span>
				<span class="c1"># Plot main sequence i.e peak velocity vs peak amplitude</span>
				<span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (deg)&quot;</span><span class="p">)</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Peak Velocity (deg/s)&quot;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">all_bin_MS</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">])):</span>
						<span class="n">peak_vel</span> <span class="o">=</span> <span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
						<span class="n">amp</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>

						<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="n">peak_vel</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
				
				<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Subjects/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">+</span> <span class="s2">&quot;/ms_main_seq&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
				<span class="n">fig2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

		<span class="n">ms_count</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">ms_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
		<span class="n">temp_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
		<span class="n">temp_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">all_bin_MS</span><span class="p">:</span>
			<span class="c1"># Net microsaccade count i.e binary + left +right</span>
			<span class="n">ms_count</span> <span class="o">+=</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;NB&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;NL&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span>

			<span class="k">if</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;NB&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
				<span class="c1"># Appending peak velocity for binary microsaccade</span>
				<span class="n">vel_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">11</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
				<span class="n">temp_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">temp_vel</span><span class="p">,</span> <span class="n">vel_val</span><span class="p">))</span>
			
				<span class="c1"># Appending amplitude for binary microsaccade</span>
				<span class="n">amp_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">13</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">14</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.</span>
				<span class="n">temp_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">temp_amp</span><span class="p">,</span> <span class="n">amp_val</span><span class="p">))</span>

				<span class="c1"># Appending durations for binary microsaccade</span>
				<span class="n">dur_val</span> <span class="o">=</span> <span class="p">((</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">-</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">][:,</span> <span class="mi">9</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.</span>
				<span class="n">ms_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ms_duration</span><span class="p">,</span> <span class="n">dur_val</span><span class="p">))</span>	
			
			<span class="k">if</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;NL&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
				<span class="c1"># Appending peak velocity for left eye microsaccade</span>
				<span class="n">temp_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">temp_vel</span><span class="p">,</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]))</span>
				
				<span class="c1"># Appending amplitude for left eye microsaccade</span>
				<span class="n">temp_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">temp_amp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][:,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

				<span class="c1"># Appending durations for left eye microsaccade</span>
				<span class="n">dur_val</span> <span class="o">=</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
				<span class="n">ms_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ms_duration</span><span class="p">,</span> <span class="n">dur_val</span><span class="p">))</span>
			
			<span class="k">if</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;NR&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
				<span class="c1"># Appending peak velocity for right eye microsaccade</span>
				<span class="n">temp_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">temp_vel</span><span class="p">,</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]))</span>
				
				<span class="c1"># Appending amplitude for right eye microsaccade</span>
				<span class="n">temp_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">temp_amp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][:,</span> <span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][:,</span> <span class="mi">6</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

				<span class="c1"># Appending durations for right eye microsaccade</span>
				<span class="n">dur_val</span> <span class="o">=</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ms</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
				<span class="n">ms_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ms_duration</span><span class="p">,</span> <span class="n">dur_val</span><span class="p">))</span>

		<span class="k">if</span> <span class="n">ms_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">ms_duration</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
			<span class="n">temp_vel</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
			<span class="n">temp_amp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
			
		<span class="k">return</span> <span class="n">all_bin_MS</span><span class="p">,</span> <span class="n">ms_count</span><span class="p">,</span> <span class="n">ms_duration</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">temp_vel</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">temp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>


<div class="viewcode-block" id="Stimulus.findSaccadeParams"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findSaccadeParams">[docs]</a>	<span class="k">def</span> <span class="nf">findSaccadeParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find saccade parameters like peak velocity, amplitude, count and duration.</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Serves as a helper function. See `findEyeMetaData`</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling Frequency of eye tracker (Defaults to 1000)</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		tuple</span>
<span class="sd">			Tuple consisting of (saccade_count, saccade_duration, saccade_peak_vel, saccade_amplitude).</span>

<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="n">saccade_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findSaccades</span><span class="p">()</span>
		<span class="n">saccade_onset</span> <span class="o">=</span> <span class="n">saccade_indices</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
		<span class="n">saccade_offset</span> <span class="o">=</span> <span class="n">saccade_indices</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

		<span class="n">saccade_count</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">saccade_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">saccade_offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">saccade_onset</span><span class="p">)</span>
		
		<span class="n">saccade_peak_vel</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">saccade_amplitude</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">saccade_onset</span><span class="p">,</span> <span class="n">saccade_offset</span><span class="p">):</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
				<span class="k">continue</span>

			<span class="n">saccade_count</span> <span class="o">+=</span> <span class="mi">1</span>

			<span class="n">vel_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position2Velocity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="p">)</span>
			<span class="n">vel_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position2Velocity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">sampling_freq</span><span class="p">)</span>

			<span class="c1"># Saccade peak velocity (vpeak)</span>
			<span class="n">vpeak</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vel_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vel_y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
			<span class="n">saccade_peak_vel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vpeak</span><span class="p">)</span>

			<span class="c1"># Saccade amplitude (dX,dY)</span>
			<span class="n">minx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">ix1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">ix2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">iy1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">iy2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
			<span class="n">dX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ix2</span> <span class="o">-</span> <span class="n">ix1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">)</span>
			<span class="n">dY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">iy2</span> <span class="o">-</span> <span class="n">iy1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span>
			<span class="n">saccade_amplitude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dX</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dY</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
		
		<span class="k">return</span> <span class="p">(</span><span class="n">saccade_count</span><span class="p">,</span> <span class="n">saccade_duration</span><span class="p">,</span> <span class="n">saccade_peak_vel</span><span class="p">,</span> <span class="n">saccade_amplitude</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stimulus.findResponseTime"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findResponseTime">[docs]</a>	<span class="k">def</span> <span class="nf">findResponseTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find the response time in milliseconds based on the sampling frequency of the eye tracker.</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Serves as a helper function. See `findEyeMetaData`</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		sampling_freq : float</span>
<span class="sd">			Sampling Frequency of eye tracker (Defaults to 1000)</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		float</span>
<span class="sd">			Response time in milliseconds</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ETRows&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1000</span><span class="o">/</span><span class="n">sampling_freq</span><span class="p">))</span></div>
	

<div class="viewcode-block" id="Stimulus.findFixationParams"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findFixationParams">[docs]</a>	<span class="k">def</span> <span class="nf">findFixationParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find fixation parameters like count, max duration and average duration.</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Does not take any input and can be invoked by an object of the class. Serves as a helper function. See `findEyeMetaData`</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		tuple</span>
<span class="sd">			Tuple consisting of (fixation_count, max_fixation_duration, avg_fixation_duration)</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">fix_num</span><span class="p">,</span> <span class="n">fix_cnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		
		<span class="n">fixation_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fix_num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

		<span class="k">if</span> <span class="n">fixation_count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">max_fixation_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fix_cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
			<span class="n">avg_fixation_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fix_cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">max_fixation_duration</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">avg_fixation_duration</span> <span class="o">=</span> <span class="mi">0</span>
		
		<span class="k">return</span> <span class="p">(</span><span class="n">fixation_count</span><span class="p">,</span> <span class="n">max_fixation_duration</span><span class="p">,</span> <span class="n">avg_fixation_duration</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stimulus.findPupilParams"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findPupilParams">[docs]</a>	<span class="k">def</span> <span class="nf">findPupilParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find pupil parameters like size, peak size, time to peak size, area under curve, slope, mean size, downsampled pupil size</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Does not take any input and can be invoked by an object of the class. Serves as a helper function. See `findEyeMetaData`</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		tuple</span>
<span class="sd">			Tuple consisting of (pupil_size, peak_pupil, time_to_peak, pupil_AUC, pupil_slope, pupil_mean, pupil_size_downsample)</span>

<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">pupil_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">peak_pupil</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)</span>
		<span class="n">time_to_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)</span>

		<span class="c1"># Finding Area Under Curve (AUC)</span>
		<span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)</span>
		<span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)</span>
		<span class="n">pupil_AUC</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">pupil_size</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">pupil_AUC</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
			<span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>			

		<span class="c1"># Finding slope of regression line fit on pupil_size data</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1500</span><span class="p">)])</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">pupil_size</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1500</span><span class="p">]</span>
		<span class="n">pupil_slope</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span><span class="n">y</span><span class="p">)</span>

		<span class="c1"># Finding mean of pupil_size data</span>
		<span class="n">pupil_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">)</span>		

		<span class="c1"># Finding decimated pupil_size value (at 60Hz)</span>
		<span class="n">frequency</span> <span class="o">=</span> <span class="mi">60</span>
		<span class="n">downsample_stride</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span><span class="o">/</span><span class="n">frequency</span><span class="p">)</span>
		<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">pupil_size_downsample</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
			<span class="n">pupil_size_downsample</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pupil_size</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>	
			<span class="n">index</span> <span class="o">+=</span> <span class="n">downsample_stride</span>	

		<span class="k">return</span> <span class="p">(</span><span class="n">pupil_size</span><span class="p">,</span> <span class="n">peak_pupil</span><span class="p">,</span> <span class="n">time_to_peak</span><span class="p">,</span> <span class="n">pupil_AUC</span><span class="p">,</span> <span class="n">pupil_slope</span><span class="p">,</span> <span class="n">pupil_mean</span><span class="p">,</span> <span class="n">pupil_size_downsample</span><span class="p">)</span></div>
		

<div class="viewcode-block" id="Stimulus.findBlinkParams"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findBlinkParams">[docs]</a>	<span class="k">def</span> <span class="nf">findBlinkParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find blink parameters like count, duration and average duration</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Does not take any input and can be invoked by an object of the class. Serves as a helper function. See `findEyeMetaData`</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		tuple</span>
<span class="sd">			Tuple consisting of (blink_cnt, peak_blink_duration, avg_blink_duration)</span>

<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">blink_cnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">blink_cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">peak_blink_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_offset&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">])))</span>
			<span class="n">avg_blink_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_offset&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">])))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">peak_blink_duration</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">avg_blink_duration</span> <span class="o">=</span> <span class="mi">0</span>
		
		<span class="k">return</span> <span class="p">(</span><span class="n">blink_cnt</span><span class="p">,</span> <span class="n">peak_blink_duration</span><span class="p">,</span> <span class="n">avg_blink_duration</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stimulus.gazePlot"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.gazePlot">[docs]</a>	<span class="k">def</span> <span class="nf">gazePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to plot eye gaze with numbered fixations.</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Can be invoked by an object of the class.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		save_fig : bool</span>
<span class="sd">			Save the gaze plot figure or not (Defaults to ``False``). If ``True``, will be saved in the Subjects folder of the experiment folder</span>
<span class="sd">		show_fig : bool</span>
<span class="sd">			Display the gaze plot figure or not (Defaults to ``True``).</span>

<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span>

		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s2">&quot;Gaze Plot: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Stimuli/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Stimuli/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_f</span><span class="p">:</span>
					<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_f</span><span class="p">)</span>
				<span class="n">width</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_width&quot;</span><span class="p">]</span>
				<span class="n">height</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_height&quot;</span><span class="p">]</span>
				<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
		
		<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

		<span class="n">fixation_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findFixations</span><span class="p">()</span>
		<span class="n">fixation_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">fixation_dict</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">fixation_dict</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]))</span>
		<span class="n">fixation_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">fixation_indices</span><span class="p">,</span> <span class="p">(</span><span class="n">fixation_indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fixation_indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>

		<span class="n">gaze_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">fixation_indices</span><span class="p">))</span>
		<span class="n">gaze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">fixation_indices</span><span class="p">))</span>
		
		<span class="n">fixation_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">saccade_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

		<span class="n">fixation_gaze_x</span> <span class="o">=</span> <span class="n">gaze_x</span><span class="p">[</span><span class="n">fixation_mask</span><span class="p">]</span>
		<span class="n">saccade_gaze_x</span> <span class="o">=</span> <span class="n">gaze_x</span><span class="p">[</span><span class="n">saccade_mask</span><span class="p">]</span>

		<span class="n">fixation_gaze_y</span> <span class="o">=</span> <span class="n">gaze_y</span><span class="p">[</span><span class="n">fixation_mask</span><span class="p">]</span>
		<span class="n">saccade_gaze_y</span> <span class="o">=</span> <span class="n">gaze_y</span><span class="p">[</span><span class="n">saccade_mask</span><span class="p">]</span>

		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>

		<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fixation_gaze_x</span><span class="p">,</span> <span class="n">fixation_gaze_y</span><span class="p">):</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
			<span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

		<span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
		
		<span class="k">if</span> <span class="n">save_fig</span><span class="p">:</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Subjects/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">+</span> <span class="s2">&quot;/gaze_plot_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stimulus.gazeHeatMap"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.gazeHeatMap">[docs]</a>	<span class="k">def</span> <span class="nf">gazeHeatMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to plot heat map of gaze.</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Can be invoked by an object of the class.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		save_fig : bool</span>
<span class="sd">			Save the heat map figure or not (Defaults to ``False``). If ``True``, will be saved in the Subjects folder of the experiment folder</span>
<span class="sd">		show_fig : bool</span>
<span class="sd">			Display the heat map figure or not (Defaults to ``True``).</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span>

		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s2">&quot;Gaze Heat Map: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		
		<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
		
		<span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
		<span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
		
		<span class="c1"># In order to get more intense values for the heatmap (ratio of points is unaffected)</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Stimuli/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Stimuli/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_f</span><span class="p">:</span>
					<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_f</span><span class="p">)</span>
				<span class="n">width</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_width&quot;</span><span class="p">]</span>
				<span class="n">height</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_height&quot;</span><span class="p">]</span>
				<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>

		<span class="n">downsample_fraction</span> <span class="o">=</span> <span class="mf">0.25</span>
		<span class="n">col_shape</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">row_shape</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="n">hist</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">)],</span> <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span><span class="p">)],[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span><span class="p">)]])</span>
		<span class="n">hist</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

		<span class="n">mycmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">GnBu</span>
		<span class="n">mycmap</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
		<span class="n">mycmap</span><span class="o">.</span><span class="n">_lut</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">255</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
		<span class="n">img</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">imresize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">downsample_fraction</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s1">&#39;lanczos&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">hist</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mycmap</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span> <span class="o">*</span> <span class="n">downsample_fraction</span><span class="p">))</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span> <span class="o">*</span> <span class="n">downsample_fraction</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">save_fig</span><span class="p">:</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Subjects/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">+</span> <span class="s2">&quot;/gaze_heatmap_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stimulus.visualize"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.visualize">[docs]</a>	<span class="k">def</span> <span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to create dynamic plot of gaze and pupil size.</span>
<span class="sd">		</span>
<span class="sd">		Internal function of class that uses its `data` member variable. Does not take any input and can be invoked by an object of the class.</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">return</span>

		<span class="n">total_range</span> <span class="o">=</span> <span class="kc">None</span>
		
		<span class="c1"># Initialising Plots</span>
		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
	
		<span class="k">try</span><span class="p">:</span>
			<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Stimuli/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Stimuli/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_f</span><span class="p">:</span>
					<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_f</span><span class="p">)</span>
				<span class="n">width</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_width&quot;</span><span class="p">]</span>
				<span class="n">height</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_height&quot;</span><span class="p">]</span>
				<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
				
		<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">total_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ETRows&quot;</span><span class="p">]))</span>
			<span class="c1"># Plot for eye gaze</span>
			<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][:</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][:</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">circle</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gaze&quot;</span><span class="p">)</span>
		
			<span class="c1"># Plot for pupil size</span>
			<span class="n">line3</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_range</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">][:</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_range</span><span class="p">)])</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">])</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Pupil Size vs. Time&quot;</span><span class="p">)</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (ms)&quot;</span><span class="p">)</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pupil Size&quot;</span><span class="p">)</span>

			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">])):</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_offset&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
			
				<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_onset&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">][</span><span class="s2">&quot;blink_offset&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

		<span class="n">axamp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">.</span><span class="mi">03</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">])</span>
		<span class="n">samp</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axamp</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">valinit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">valstep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

		<span class="n">is_manual</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="k">def</span> <span class="nf">update_slider</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
			<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			&quot;&quot;&quot;</span>
			<span class="k">nonlocal</span> <span class="n">is_manual</span>
			<span class="n">is_manual</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
			<span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

		<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
			<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			&quot;&quot;&quot;</span>
			<span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
			
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">line</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][:</span><span class="n">i</span><span class="p">])</span>
				<span class="n">line</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][:</span><span class="n">i</span><span class="p">])</span>
			
				<span class="n">circle</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
				<span class="n">circle</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
				
				<span class="n">line3</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">total_range</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
				<span class="n">line3</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">][:</span><span class="n">i</span><span class="p">])</span>
				<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">][:</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">][:</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">5</span><span class="p">])</span>      
		
			<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

		<span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
			<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			&quot;&quot;&quot;</span>
			<span class="k">nonlocal</span> <span class="n">is_manual</span>
			<span class="k">if</span> <span class="n">is_manual</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">circle</span><span class="p">,</span> <span class="n">line3</span><span class="p">]</span>

			<span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">samp</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">total_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">samp</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
			<span class="n">is_manual</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># the above line called update_slider, so we need to reset this</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
			
			<span class="k">return</span> <span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">circle</span><span class="p">,</span> <span class="n">line3</span><span class="p">]</span>
			

		<span class="k">def</span> <span class="nf">on_click</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
			<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			&quot;&quot;&quot;</span>
			<span class="k">nonlocal</span> <span class="n">is_manual</span>
			<span class="c1"># Check where the click happened</span>
			<span class="p">(</span><span class="n">xm</span><span class="p">,</span><span class="n">ym</span><span class="p">),(</span><span class="n">xM</span><span class="p">,</span><span class="n">yM</span><span class="p">)</span> <span class="o">=</span> <span class="n">samp</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">clipbox</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">xm</span> <span class="o">&lt;</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xM</span> <span class="ow">and</span> <span class="n">ym</span> <span class="o">&lt;</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">yM</span><span class="p">):</span>
				<span class="c1"># Event happened within the slider or checkbox, ignore since it is handled in update_slider</span>
				<span class="k">return</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c1"># user clicked somewhere else on canvas = unpause</span>
				<span class="n">is_manual</span><span class="o">=</span><span class="kc">False</span>

		<span class="c1"># call update function on slider value change</span>
		<span class="n">samp</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_slider</span><span class="p">)</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="n">on_click</span><span class="p">)</span>

		<span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update_plot</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

		<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Stimulus.findEyeMetaData"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.findEyeMetaData">[docs]</a>	<span class="k">def</span> <span class="nf">findEyeMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling_freq</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to find all metadata/features of eye tracking data.</span>

<span class="sd">		Internal function of class that uses its `data` member variable. Can be invoked by an object of the class. The metadata is stored in the sensor object of the class and can be accessed in the following manner. </span>

<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		The following code will return the metadata dictionary containing all meta features extracted.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; stim_obj.findEyeMetaData()</span>
<span class="sd">		&gt;&gt;&gt; stim_obj.sensors[&quot;EyeTracker&quot;].metadata</span>
<span class="sd">		</span>
<span class="sd">		This segment allows you to extract individual features</span>

<span class="sd">		&gt;&gt;&gt; stim_obj.sensors[&quot;EyeTracker&quot;].metadata[&quot;pupil_slope&quot;]</span>
<span class="sd">		&gt;&gt;&gt; stim_obj.sensors[&quot;EyeTracker&quot;].metadata[&quot;fixation_count&quot;]</span>

<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1"># Finding word and character count in text stimulus</span>
		<span class="n">num_chars</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">num_words</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;relevant&quot;</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="s2">&quot;general_lie&quot;</span><span class="p">]:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;questions.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">q_file</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">q_file</span><span class="p">)</span>

			<span class="n">num_chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
			<span class="n">num_words</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

		<span class="c1"># Finding response time based on number of  samples </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">response_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findResponseTime</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;response_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_time</span> <span class="o">/</span> <span class="n">num_words</span>
	
		<span class="c1"># Pupil Features</span>
		<span class="n">pupil_size</span><span class="p">,</span> <span class="n">peak_pupil</span><span class="p">,</span> <span class="n">time_to_peak</span><span class="p">,</span> <span class="n">pupil_AUC</span><span class="p">,</span> <span class="n">pupil_slope</span><span class="p">,</span> <span class="n">pupil_mean</span><span class="p">,</span> <span class="n">pupil_size_downsample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPupilParams</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;pupil_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pupil_size</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;peak_pupil&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peak_pupil</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;time_to_peak_pupil&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_to_peak</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;pupil_area_curve&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pupil_AUC</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;pupil_slope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pupil_slope</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;pupil_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pupil_mean</span>		
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;pupil_size_downsample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pupil_size_downsample</span>

		<span class="c1"># Blink Features</span>
		<span class="n">blink_cnt</span><span class="p">,</span> <span class="n">peak_blink</span><span class="p">,</span> <span class="n">avg_blink</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findBlinkParams</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;blink_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blink_cnt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;peak_blink_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peak_blink</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;avg_blink_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_blink</span>
		
		<span class="c1"># Fixation Features</span>
		<span class="n">fix_cnt</span><span class="p">,</span> <span class="n">max_fix_cnt</span><span class="p">,</span> <span class="n">avg_fix_cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findFixationParams</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;fixation_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fix_cnt</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;max_fixation_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_fix_cnt</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;avg_fixation_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_fix_cnt</span>

		<span class="c1"># Saccade Features</span>
		<span class="n">saccade_count</span><span class="p">,</span> <span class="n">saccade_duration</span><span class="p">,</span> <span class="n">saccade_peak_vel</span><span class="p">,</span> <span class="n">saccade_amplitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findSaccadeParams</span><span class="p">(</span><span class="n">sampling_freq</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sacc_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saccade_count</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sacc_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saccade_duration</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sacc_vel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saccade_peak_vel</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sacc_amplitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saccade_amplitude</span>

		<span class="c1"># Microsaccade Features</span>
		<span class="n">_</span><span class="p">,</span> <span class="n">ms_count</span><span class="p">,</span> <span class="n">ms_duration</span><span class="p">,</span> <span class="n">ms_vel</span><span class="p">,</span> <span class="n">ms_amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findMicrosaccades</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ms_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_count</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ms_duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_duration</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ms_vel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_vel</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ms_amplitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_amp</span></div>


<div class="viewcode-block" id="Stimulus.getData"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.getData">[docs]</a>	<span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sensor_names</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to extract data and store in local format.</span>
<span class="sd">		</span>
<span class="sd">		It is invoked by `init__` when the object of the class is created. This function is used in the *Experiment Design*.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		data : pandas DataFrame</span>
<span class="sd">			DataFrame containing the eye tracking data.</span>
<span class="sd">		sensor_names : list (str)</span>
<span class="sd">			List of sensors being used for the experiment (currently supports only EyeTracker).</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		extracted_data : dict </span>
<span class="sd">			Dictionary of extracted data to be used by the functions of the class.</span>
<span class="sd">			- &quot;ETRows&quot; : list,</span>
<span class="sd">			- &quot;FixationSeq&quot; : list,</span>
<span class="sd">			- &quot;Gaze&quot; : dict,</span>
<span class="sd">			- &quot;InterpPupilSize&quot; : list,</span>
<span class="sd">			- &quot;InterpGaze&quot; : dict,</span>
<span class="sd">			- &quot;BlinksLeft&quot; : dict,</span>
<span class="sd">			- &quot;BlinksRight&quot; : dict</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="c1"># Extracting data for particular stimulus</span>
		
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">jf</span><span class="p">:</span>
			<span class="n">contents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jf</span><span class="p">)</span>

		<span class="n">extracted_data</span> <span class="o">=</span> <span class="p">{</span>	<span class="s2">&quot;ETRows&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;FixationSeq&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;Gaze&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;InterpPupilSize&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;InterpGaze&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;BlinksLeft&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;BlinksRight&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

		<span class="k">for</span> <span class="n">col_class</span> <span class="ow">in</span> <span class="n">sensor_names</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">col_class</span> <span class="o">==</span> <span class="s2">&quot;EyeTracker&quot;</span><span class="p">:</span>
				<span class="n">et_sfreq</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Sampling_Freq&quot;</span><span class="p">]</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col_class</span> <span class="p">:</span> <span class="n">Sensor</span><span class="p">(</span><span class="n">col_class</span><span class="p">,</span> <span class="n">et_sfreq</span><span class="p">)})</span>

				<span class="n">l_gazex_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeLeftx</span><span class="p">)</span>
				<span class="n">l_gazey_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeLefty</span><span class="p">)</span>
				<span class="n">r_gazex_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeRightx</span><span class="p">)</span>
				<span class="n">r_gazey_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeRighty</span><span class="p">)</span>
				<span class="n">pupil_size_l_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PupilLeft</span><span class="p">)</span>
				<span class="n">pupil_size_r_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PupilRight</span><span class="p">)</span>

				<span class="c1"># Extracting fixation sequences</span>
				<span class="n">et_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EventSource</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;ET&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">fixation_seq_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">FixationSeq</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
				<span class="n">fixation_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fixation_seq_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				
				<span class="c1"># Extracting the eye gaze data</span>
				<span class="n">l_gaze_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_gazex_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">l_gaze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_gazey_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">l_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">l_gaze_x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">l_gaze_y</span><span class="p">}</span>
				<span class="n">r_gaze_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_gazex_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">r_gaze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_gazey_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">r_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">r_gaze_x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">r_gaze_y</span><span class="p">}</span>
				<span class="n">gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="n">l_gaze</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="n">r_gaze</span><span class="p">}</span>
				
				<span class="c1"># Extracting Pupil Size Data</span>
				<span class="n">pupil_size_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pupil_size_r_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">pupil_size_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pupil_size_l_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				
				<span class="c1"># Fixing Blinks and interpolating pupil size and gaze data</span>
				<span class="n">blinks_l</span><span class="p">,</span> <span class="n">interp_pupil_size_l</span><span class="p">,</span> <span class="n">new_gaze_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findBlinks</span><span class="p">(</span><span class="n">pupil_size_l</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">blinks_r</span><span class="p">,</span> <span class="n">interp_pupil_size_r</span><span class="p">,</span> <span class="n">new_gaze_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findBlinks</span><span class="p">(</span><span class="n">pupil_size_r</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">interp_pupil_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">interp_pupil_size_r</span><span class="p">,</span> <span class="n">interp_pupil_size_l</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;ETRows&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">et_rows</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixation_seq</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaze</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_pupil_size</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_gaze_l</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blinks_l</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;BlinksRight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blinks_r</span>

		<span class="k">return</span> <span class="n">extracted_data</span></div>


<div class="viewcode-block" id="Stimulus.getDataStandAlone"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.Stimulus.getDataStandAlone">[docs]</a>	<span class="k">def</span> <span class="nf">getDataStandAlone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sensor_names</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Function to extract data and store in local format.</span>
<span class="sd">		</span>
<span class="sd">		It is invoked by `init__` when the object of the class is created. This function is used in the *Stand-alone Design*.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		data : pandas DataFrame</span>
<span class="sd">			DataFrame containing the eye tracking data.</span>
<span class="sd">		sensor_names : dict</span>
<span class="sd">			Dictionary of dictionaries containing list of sensors being used for the experiment (currently supports only EyeTracker) and their Parameters. See `sensor_names` in Stimulus for details.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		extracted_data : dict </span>
<span class="sd">			Dictionary of extracted data to be used by the functions of the class.</span>
<span class="sd">			- &quot;ETRows&quot; : list,</span>
<span class="sd">			- &quot;FixationSeq&quot; : list,</span>
<span class="sd">			- &quot;Gaze&quot; : dict,</span>
<span class="sd">			- &quot;InterpPupilSize&quot; : list,</span>
<span class="sd">			- &quot;InterpGaze&quot; : dict,</span>
<span class="sd">			- &quot;BlinksLeft&quot; : dict,</span>
<span class="sd">			- &quot;BlinksRight&quot; : dict</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">extracted_data</span> <span class="o">=</span> <span class="p">{</span>	<span class="s2">&quot;ETRows&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;FixationSeq&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;Gaze&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;InterpPupilSize&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;InterpGaze&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;BlinksLeft&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
							<span class="s2">&quot;BlinksRight&quot;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

		<span class="k">for</span> <span class="n">sen</span> <span class="ow">in</span> <span class="n">sensor_names</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">sen</span> <span class="o">==</span> <span class="s2">&quot;EyeTracker&quot;</span><span class="p">:</span>
				<span class="n">et_sfreq</span> <span class="o">=</span> <span class="n">sensor_names</span><span class="p">[</span><span class="n">sen</span><span class="p">][</span><span class="s2">&quot;Sampling_Freq&quot;</span><span class="p">]</span>

				<span class="bp">self</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">sen</span> <span class="p">:</span> <span class="n">Sensor</span><span class="p">(</span><span class="n">sen</span><span class="p">,</span> <span class="n">et_sfreq</span><span class="p">)})</span>

				<span class="n">l_gazex_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeLeftx</span><span class="p">)</span>
				<span class="n">l_gazey_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeLefty</span><span class="p">)</span>
				<span class="n">r_gazex_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeRightx</span><span class="p">)</span>
				<span class="n">r_gazey_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GazeRighty</span><span class="p">)</span>
				<span class="n">pupil_size_l_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PupilLeft</span><span class="p">)</span>
				<span class="n">pupil_size_r_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PupilRight</span><span class="p">)</span>

				<span class="c1"># Extracting fixation sequences</span>
				<span class="n">et_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EventSource</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;ET&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">fixation_seq_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">FixationSeq</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
				<span class="n">fixation_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fixation_seq_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				
				<span class="c1"># Extracting the eye gaze data</span>
				<span class="n">l_gaze_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_gazex_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">l_gaze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_gazey_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">l_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">l_gaze_x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">l_gaze_y</span><span class="p">}</span>
				<span class="n">r_gaze_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_gazex_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">r_gaze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_gazey_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">r_gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">r_gaze_x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">r_gaze_y</span><span class="p">}</span>
				<span class="n">gaze</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span> <span class="p">:</span> <span class="n">l_gaze</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span> <span class="p">:</span> <span class="n">r_gaze</span><span class="p">}</span>
				
				<span class="c1"># Extracting Pupil Size Data</span>
				<span class="n">pupil_size_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pupil_size_r_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				<span class="n">pupil_size_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pupil_size_l_df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">et_rows</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">))</span>
				
				<span class="c1"># Fixing Blinks and interpolating pupil size and gaze data</span>
				<span class="n">blinks_l</span><span class="p">,</span> <span class="n">interp_pupil_size_l</span><span class="p">,</span> <span class="n">new_gaze_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findBlinks</span><span class="p">(</span><span class="n">pupil_size_l</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">blinks_r</span><span class="p">,</span> <span class="n">interp_pupil_size_r</span><span class="p">,</span> <span class="n">new_gaze_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findBlinks</span><span class="p">(</span><span class="n">pupil_size_r</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">interp_pupil_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">interp_pupil_size_r</span><span class="p">,</span> <span class="n">interp_pupil_size_l</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;ETRows&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">et_rows</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;FixationSeq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixation_seq</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;Gaze&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaze</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;InterpPupilSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_pupil_size</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_gaze_l</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;BlinksLeft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blinks_l</span>
				<span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;BlinksRight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blinks_r</span>

		<span class="k">return</span> <span class="n">extracted_data</span></div></div>


<div class="viewcode-block" id="groupHeatMap"><a class="viewcode-back" href="../../PyTrack.html#PyTrack.Stimulus.groupHeatMap">[docs]</a><span class="k">def</span> <span class="nf">groupHeatMap</span><span class="p">(</span><span class="n">sub_list</span><span class="p">,</span> <span class="n">stim_name</span><span class="p">,</span> <span class="n">json_file</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Function to plot aggregate heat map of gaze for a list if subjects.</span>

<span class="sd">		Invoked by the `subjectVisualize` function of the `Subject` class.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		sub_list : list (Subject)</span>
<span class="sd">			List of `Subject` class objects to plot the gaze heat map for.</span>
<span class="sd">		stim_name : dict</span>
<span class="sd">			Dictionary containing the type of stimulus and the number of stimulus of that type. {stim_type:stim_num}</span>
<span class="sd">		json_file : str</span>
<span class="sd">			Name of json file containing details of the experiment.</span>
<span class="sd">		</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
	<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s2">&quot;Aggregate Gaze Heat Map&quot;</span><span class="p">)</span>
	
	<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
	
	<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">stim_type</span><span class="p">,</span> <span class="n">stim_num</span> <span class="o">=</span> <span class="n">stim_name</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>

	<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">sub_list</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">sub</span><span class="o">.</span><span class="n">stimulus</span><span class="p">[</span><span class="n">stim_type</span><span class="p">][</span><span class="n">stim_num</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">stimulus</span><span class="p">[</span><span class="n">stim_type</span><span class="p">][</span><span class="n">stim_num</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]))</span>
			<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">stimulus</span><span class="p">[</span><span class="n">stim_type</span><span class="p">][</span><span class="n">stim_num</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;InterpGaze&quot;</span><span class="p">][</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>

	<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_list</span><span class="p">):</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
		<span class="k">return</span>		
	
	<span class="c1"># In order to get more intense values for the heatmap (ratio of points is unaffected)</span>
	<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_f</span><span class="p">:</span>
		<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_f</span><span class="p">)</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Path&quot;</span><span class="p">]</span>
		<span class="n">width</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_width&quot;</span><span class="p">]</span>
		<span class="n">height</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;Analysis_Params&quot;</span><span class="p">][</span><span class="s2">&quot;EyeTracker&quot;</span><span class="p">][</span><span class="s2">&quot;Display_height&quot;</span><span class="p">]</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/Stimuli/&quot;</span> <span class="o">+</span> <span class="n">sub_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stimulus</span><span class="p">[</span><span class="n">stim_type</span><span class="p">][</span><span class="n">stim_num</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">)</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;Stimuli/&quot;</span> <span class="o">+</span> <span class="n">sub_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stimulus</span><span class="p">[</span><span class="n">stim_type</span><span class="p">][</span><span class="n">stim_num</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			
			
			<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>

	<span class="n">downsample_fraction</span> <span class="o">=</span> <span class="mf">0.25</span>
	<span class="n">col_shape</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">row_shape</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

	<span class="n">hist</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">)],</span> <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span><span class="p">)],[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span><span class="p">)]])</span>
	<span class="n">hist</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

	<span class="n">mycmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">GnBu</span>
	<span class="n">mycmap</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
	<span class="n">mycmap</span><span class="o">.</span><span class="n">_lut</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">255</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
	<span class="n">img</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">imresize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">downsample_fraction</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s1">&#39;lanczos&#39;</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span><span class="o">*</span><span class="n">downsample_fraction</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">hist</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mycmap</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_shape</span> <span class="o">*</span> <span class="n">downsample_fraction</span><span class="p">))</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row_shape</span> <span class="o">*</span> <span class="n">downsample_fraction</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">PyTrack 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Upamanyu Ghose, Arvind Srinivasan.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>